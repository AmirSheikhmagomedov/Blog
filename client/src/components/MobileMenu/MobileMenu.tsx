import { useContext } from 'react';
import { Link } from 'react-router-dom';
import { toast } from 'react-toastify';
import axios from '../../utils/axios';
import { DarkThemeContext } from '../../context/DarkThemeProvider';
import profileImage from '../../assets/profile.jpg';
import styles from './MobileMenu.module.scss';
import { useAppDispatch, useAppSelector } from '../../hooks/reduxHooks';
import { deleteMessage, signOut } from '../../redux/features/userSlice';

export default function MobileMenu({
  onClick = () => {},
  onSignOut = () => {},
}: {
  onClick?: () => void;
  onSignOut: () => void;
}) {
  const { isDarkTheme, toggleDarkTheme } = useContext(DarkThemeContext);

  const { user } = useAppSelector((state) => state.user);

  const dispatch = useAppDispatch();

  return (
    <div
      className={
        isDarkTheme ? styles['mobile-menu-dark'] : styles['mobile-menu']
      }
    >
      <button
        className={styles['mobile-menu__close-button']}
        type="button"
        onClick={onClick}
      >
        <svg
          width="36"
          height="36"
          viewBox="0 0 36 36"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M30.7251 5.2691C27.3489 1.89464 22.7702 -0.000560918 17.9971 1.2453e-07C13.2236 0.000821982 8.64595 1.89766 5.27128 5.27317C1.89597 8.64875 0 13.2266 0 18.0004C0 22.7742 1.89597 27.3516 5.27128 30.7277C8.6463 34.1032 13.2241 36.0001 17.9971 36.0008C22.7703 36.0014 27.349 34.1062 30.7251 30.7317C32.9605 28.4972 34.568 25.7136 35.3863 22.6604C36.2046 19.6073 36.2046 16.3931 35.3863 13.3401C34.568 10.2871 32.9605 7.50366 30.7251 5.26882V5.2691ZM28.4012 28.4072C26.3425 30.4689 23.7184 31.8732 20.8608 32.443C18.0035 33.0128 15.0413 32.7221 12.349 31.608C9.65695 30.4939 7.35583 28.6064 5.7368 26.1839C4.11749 23.7616 3.25349 20.9137 3.25349 17.9996C3.25349 15.0856 4.11749 12.238 5.7368 9.81544C7.35583 7.39293 9.65695 5.50544 12.349 4.39128C15.0411 3.27712 18.0033 2.9865 20.8608 3.55631C23.7183 4.12612 26.3424 5.53034 28.4012 7.5921C31.1593 10.3535 32.7084 14.0967 32.7084 17.9994C32.7084 21.9022 31.1593 25.645 28.4012 28.4068V28.4072Z"
            fill={isDarkTheme ? '#ffffff' : '#292929'}
          />
          <path
            d="M26.1769 9.90008C25.87 9.59517 25.4556 9.42423 25.023 9.42423C24.5907 9.42423 24.176 9.59517 23.8694 9.90008L17.9949 15.693L12.202 9.90008C11.7809 9.53929 11.2054 9.41656 10.6736 9.57381C10.1419 9.73106 9.72576 10.1472 9.56853 10.6789C9.41128 11.2107 9.53401 11.7862 9.89479 12.2073L15.6877 18.0002L9.89479 23.7931C9.58989 24.0996 9.41895 24.5144 9.41895 24.9467C9.41895 25.3789 9.58989 25.7937 9.89479 26.1002C10.2035 26.4065 10.6216 26.5772 11.0566 26.5747C11.4858 26.5731 11.8973 26.4027 12.2019 26.1002L17.9948 20.3073L23.7877 26.1821C24.0924 26.4843 24.5038 26.6547 24.9331 26.6566C25.3961 26.6818 25.8481 26.5092 26.1768 26.1821C26.4814 25.8753 26.6527 25.4609 26.6527 25.0283C26.6527 24.596 26.4814 24.1813 26.1768 23.8747L20.302 18.0002L26.1768 12.2073C26.4814 11.9007 26.6527 11.486 26.6527 11.0537C26.6527 10.6214 26.4815 10.2066 26.1769 9.90008Z"
            fill={isDarkTheme ? '#ffffff' : '#292929'}
          />
        </svg>
      </button>
      <div className={styles['mobile-menu__profile']}>
        <div
          className={styles['mobile-menu__image']}
          style={{
            border: isDarkTheme
              ? user?.avatar
                ? ''
                : '1px solid #7a7a7a'
              : user?.avatar
              ? ''
              : '1px solid #dcdcdc',
          }}
        >
          {user?.avatar ? (
            <img
              src={`${import.meta.env.VITE_REACT_BACKEND_ASSETS}${
                user?.avatar
              }`}
              alt="Avatar"
              crossOrigin="anonymous"
              style={{ width: '100%', height: '100%' }}
            />
          ) : (
            <img
              src={profileImage}
              alt="Avatar"
              style={{ width: '100%', height: '100%' }}
            />
          )}
        </div>
        <div
          className={styles['mobile-menu__name']}
        >{`${user?.firstName} ${user?.lastName}`}</div>
      </div>
      <div className={styles['mobile-menu__buttons']}>
        <Link
          className={styles['mobile-menu__profile-link']}
          onClick={onClick}
          to={`/profile/${user?.username}`}
          style={{ color: isDarkTheme ? '#9b9b9b' : '' }}
        >
          <svg
            width="32"
            height="32"
            viewBox="0 0 32 32"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M16 32C7.17714 32 0 24.8229 0 16C0 7.17714 7.17714 0 16 0C24.8229 0 32 7.17714 32 16C32 24.8229 24.8229 32 16 32ZM16 1.4003C7.95008 1.4003 1.4003 7.95008 1.4003 16C1.4003 24.0499 7.95008 30.5997 16 30.5997C24.0499 30.5997 30.5997 24.0499 30.5997 16C30.5997 7.95008 24.0499 1.4003 16 1.4003Z"
              fill={isDarkTheme ? '#9b9b9b' : '#757575'}
            />
            <path
              d="M16.0002 19.3895C12.9981 19.3895 10.5557 16.9471 10.5557 13.9446C10.5557 10.9425 12.9981 8.50008 16.0002 8.50008C19.0024 8.50008 21.4448 10.9425 21.4448 13.9446C21.4448 16.947 19.0024 19.3895 16.0002 19.3895ZM16.0002 9.90074C13.7705 9.90074 11.9561 11.7149 11.9561 13.9449C11.9561 16.1747 13.7705 17.989 16.0002 17.989C18.23 17.989 20.0444 16.1744 20.0444 13.9446C20.0444 11.7149 18.23 9.90074 16.0002 9.90074Z"
              fill={isDarkTheme ? '#9b9b9b' : '#757575'}
            />
            <path
              d="M7.5521 29.4502C7.52883 29.4502 7.50557 29.4488 7.48231 29.4465C7.09721 29.4086 6.81596 29.0656 6.85404 28.6807C7.32067 23.9594 11.2525 20.3992 15.9999 20.3992C18.448 20.3992 20.7603 21.3525 22.51 23.0835C24.0173 24.6095 24.951 26.5966 25.1455 28.6845C25.1815 29.0696 24.8986 29.411 24.5132 29.4467C24.1201 29.4855 23.7867 29.1993 23.751 28.8144C23.5863 27.0477 22.7938 25.364 21.5191 24.0734C20.0386 22.6095 18.0765 21.7996 15.9996 21.7996C11.9758 21.7996 8.64321 24.817 8.24742 28.818C8.21194 29.1798 7.9072 29.45 7.55148 29.45L7.5521 29.4502Z"
              fill={isDarkTheme ? '#9b9b9b' : '#757575'}
            />
          </svg>
          Profile
        </Link>
        <button
          className={styles['mobile-menu__theme-button']}
          type="button"
          onClick={toggleDarkTheme}
          style={{ color: isDarkTheme ? '#9b9b9b' : '' }}
        >
          {isDarkTheme ? (
            <svg
              width="32"
              height="32"
              viewBox="0 0 32 32"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M16 7.81067C13.8279 7.81067 11.745 8.67333 10.2093 10.2093C8.67337 11.745 7.81067 13.828 7.81067 16C7.81067 18.172 8.67333 20.2551 10.2093 21.7907C11.745 23.3267 13.828 24.1893 16 24.1893C18.172 24.1893 20.2551 23.3267 21.7907 21.7907C23.3267 20.2551 24.1893 18.172 24.1893 16C24.1879 13.8283 23.3248 11.7464 21.7892 10.2107C20.2536 8.67504 18.1717 7.81205 16 7.81067ZM16 22.114C14.3785 22.114 12.8238 21.47 11.6772 20.3232C10.5304 19.1767 9.88639 17.6219 9.88639 16.0004C9.88639 14.3788 10.5304 12.8241 11.6772 11.6776C12.8237 10.5307 14.3785 9.88675 16 9.88675C17.6215 9.88675 19.1763 10.5308 20.3228 11.6776C21.4696 12.8241 22.1136 14.3788 22.1136 16.0004C22.1107 17.6211 21.466 19.1744 20.3199 20.3201C19.1741 21.4663 17.6207 22.1112 16 22.114ZM14.9621 5.07029V1.03786C14.9621 0.464797 15.4265 0 16 0C16.5735 0 17.0379 0.464816 17.0379 1.03786V5.07029C17.0379 5.64372 16.5735 6.10852 16 6.10852C15.4265 6.10852 14.9621 5.64371 14.9621 5.07029ZM7.60289 3.54479C7.31655 3.04739 7.48705 2.41165 7.98445 2.12539C8.48185 1.83867 9.1172 2.00955 9.40384 2.50659L11.4174 6.00429C11.5694 6.24285 11.6168 6.53355 11.5499 6.80831C11.4825 7.08307 11.3059 7.31839 11.0612 7.45992C10.8161 7.60147 10.5239 7.63695 10.2524 7.55839C9.98056 7.47947 9.75287 7.29304 9.62181 7.04253L7.60289 3.54479ZM2.13299 8.01307C2.41971 7.52073 3.04995 7.35168 3.54479 7.63405L7.03748 9.64757C7.53452 9.93391 7.70539 10.57 7.41868 11.0673C7.13233 11.5644 6.49665 11.7352 5.99965 11.4485L2.50668 9.43C2.01327 9.14112 1.84627 8.50756 2.13299 8.01307ZM5.07029 17.038H1.03786C0.464797 17.038 0 16.5735 0 16.0001C0 15.4267 0.464815 14.9623 1.03786 14.9623H5.07029C5.64372 14.9623 6.10852 15.4267 6.10852 16.0001C6.10852 16.5735 5.64371 17.038 5.07029 17.038ZM7.06316 22.3627L3.54479 24.3972C3.38659 24.4867 3.2074 24.5333 3.02567 24.5319C2.55649 24.5312 2.14635 24.2159 2.02505 23.7629C1.90343 23.3097 2.10108 22.8315 2.50653 22.5961L6.00424 20.5827C6.49693 20.3245 7.10584 20.5012 7.38424 20.9827C7.66263 21.4645 7.51203 22.08 7.04249 22.3783L7.06316 22.3627ZM11.4485 25.9955L9.42996 29.4936C9.24461 29.8143 8.90252 30.0119 8.53181 30.0123C8.34973 30.0119 8.17053 29.9637 8.01305 29.8723C7.51747 29.5851 7.34805 28.9512 7.63404 28.4553L9.64757 24.9627C9.93392 24.4656 10.57 24.2947 11.0673 24.5815C11.5644 24.8677 11.7352 25.5035 11.4485 26.0004L11.4485 25.9955ZM17.0379 26.9297V30.9623C17.0379 31.5353 16.5735 32.0001 16 32.0001C15.4265 32.0001 14.9621 31.5353 14.9621 30.9623V26.9297C14.9621 26.3564 15.4265 25.8916 16 25.8916C16.5735 25.8916 17.0379 26.3564 17.0379 26.9297ZM24.3971 28.4553C24.6831 28.9512 24.5137 29.5851 24.0181 29.8723C23.7795 30.0112 23.4953 30.0496 23.2285 29.9783C22.9613 29.9073 22.734 29.7328 22.5961 29.4936L20.5825 25.9959C20.3245 25.5032 20.5012 24.8943 20.9827 24.6159C21.4644 24.3375 22.0799 24.488 22.3781 24.9576L24.3971 28.4553ZM29.8671 24.0077C29.5799 24.5033 28.946 24.6727 28.4501 24.3867L24.9524 22.3732C24.4551 22.0864 24.2841 21.4508 24.5708 20.9537C24.8576 20.4564 25.4929 20.2855 25.9903 20.5723L29.4935 22.5701C29.9868 22.8591 30.1537 23.4925 29.8671 23.9871V24.0077ZM32 16.0001C32 16.2752 31.8907 16.5395 31.6959 16.7339C31.5012 16.9287 31.2372 17.038 30.9621 17.038H26.9297C26.3563 17.038 25.8915 16.5735 25.8915 16.0001C25.8915 15.4267 26.3563 14.9623 26.9297 14.9623H30.9621C31.2372 14.9623 31.5012 15.0716 31.6959 15.2664C31.8907 15.4608 32 15.7249 32 16.0001ZM24.9368 9.62189L28.4552 7.60299C28.9527 7.31664 29.5884 7.48715 29.8747 7.98455C30.1613 8.48195 29.9904 9.11729 29.4935 9.40393L25.9957 11.4175C25.8389 11.5116 25.6591 11.5601 25.4765 11.5576C25.0075 11.5568 24.5972 11.2415 24.4756 10.7887C24.3544 10.3354 24.5516 9.85719 24.9575 9.62189H24.9368ZM20.5515 5.98916L22.57 2.50665C22.7015 2.25615 22.9292 2.06971 23.2007 1.99115C23.4725 1.91223 23.7643 1.94771 24.0093 2.08925C24.2541 2.2308 24.4308 2.46611 24.4981 2.74087C24.5655 3.01563 24.5176 3.30596 24.366 3.54488L22.3524 7.03759C22.0661 7.53463 21.43 7.70549 20.9327 7.41879C20.4356 7.13244 20.2648 6.49675 20.5515 5.99976V5.98916Z"
                fill="#9b9b9b"
              />
            </svg>
          ) : (
            <svg
              width="32"
              height="32"
              viewBox="0 0 32 32"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M31.9802 18.2658C31.3474 22.1828 29.3567 25.6335 26.5188 28.0948C23.71 30.53 20.0725 32 16.0991 32C11.6536 32 7.62824 30.1624 4.715 27.1905C1.80147 24.2186 0 20.1125 0 15.5789C0 12.0266 1.10792 8.73577 2.99073 6.0467C4.92457 3.28577 7.67547 1.16032 10.8838 0.04044C11.2755 -0.0945492 11.6999 0.119435 11.8331 0.518133C11.9124 0.75698 11.8693 1.00768 11.7381 1.19959C11.1209 2.19891 10.6371 3.28905 10.3088 4.44611C9.98947 5.57016 9.81909 6.76445 9.81909 8.00865C9.81909 11.543 11.2229 14.7417 13.4936 17.0579C15.7635 19.3732 18.9002 20.8061 22.3651 20.8061C23.9482 20.8061 25.4618 20.5073 26.8549 19.9626C28.3008 19.3971 29.6186 18.5656 30.7499 17.5284C31.0574 17.2456 31.5308 17.2716 31.808 17.5853C31.9774 17.7772 32.0332 18.033 31.9813 18.2677L31.9802 18.2658ZM25.552 26.9296C27.6348 25.1229 29.2149 22.7307 30.0456 20.0026C29.2167 20.5563 28.3263 21.0237 27.3879 21.3906C25.8273 22.0012 24.1336 22.3349 22.3642 22.3349C18.4858 22.3349 14.975 20.731 12.4326 18.139C9.89154 15.5458 8.31917 11.9644 8.31917 8.0084C8.31917 6.63132 8.51323 5.29345 8.87358 4.02231C9.041 3.43169 9.24486 2.85621 9.482 2.30067C7.37959 3.39289 5.57129 4.98862 4.21054 6.93336C2.50493 9.36947 1.50086 12.3544 1.50086 15.5799C1.50086 19.6919 3.13492 23.4152 5.77696 26.1102C8.41899 28.8052 12.0682 30.472 16.1004 30.472C19.7064 30.472 23.0068 29.1399 25.5533 26.9306L25.552 26.9296Z"
                fill="#757575"
              />
            </svg>
          )}
          {isDarkTheme ? 'Light theme' : 'Dark theme'}
        </button>
        <button
          className={styles['mobile-menu__signout-button']}
          type="button"
          style={{ color: isDarkTheme ? '#9b9b9b' : '' }}
          onClick={async () => {
						dispatch(signOut());
            toast.info('You signed out');
            dispatch(deleteMessage());
            onSignOut();
            document.body.classList.remove('no-scroll');
            await axios.get('/user/signout');
          }}
        >
          <svg
            width="32"
            height="27"
            viewBox="0 0 32 27"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M9.24121 12.7702H26.8878V14.6482H9.24121V12.7702Z"
              fill={isDarkTheme ? '#9b9b9b' : '#757575'}
            />
            <path
              d="M27.7485 8.97006L26.3828 10.1982L29.453 13.892L25.9014 17.0849L27.0819 18.5054L32.0003 14.0843L27.7485 8.97006Z"
              fill={isDarkTheme ? '#9b9b9b' : '#757575'}
            />
            <path
              d="M22.8751 21.221C22.8751 23.1882 21.3359 24.5582 19.4442 24.5582L5.23701 24.5579C3.3453 24.5579 1.80604 23.1882 1.80604 21.2207V5.44596C1.80604 3.47868 3.3453 1.87794 5.23701 1.87794H19.4442C21.3359 1.87794 22.8751 3.47868 22.8751 5.44596L22.885 10.0523H24.6807V5.44623C24.6807 2.44333 22.3312 0.00026199 19.4439 0.00026199L5.23677 0C2.34922 0 0 2.44334 0 5.44597V21.2207C0 24.2236 2.34948 26.6667 5.23677 26.6667H19.4439C22.3315 26.6667 24.6807 24.2233 24.6807 21.2406L24.6905 17.0192L22.9613 16.9794L22.8751 21.221Z"
              fill={isDarkTheme ? '#9b9b9b' : '#757575'}
            />
          </svg>
          Sign out
        </button>
      </div>
    </div>
  );
}
