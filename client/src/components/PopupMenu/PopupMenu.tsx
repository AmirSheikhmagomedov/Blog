import { Link, useNavigate } from 'react-router-dom';
import { useContext } from 'react';
import { toast } from 'react-toastify';
import ClickAwayListener from 'react-click-away-listener';
import { DarkThemeContext } from '../../context/DarkThemeProvider';
import styles from './PopupMenu.module.scss';
import { signOut, deleteMessage } from '../../redux/features/userSlice';
import { useAppDispatch, useAppSelector } from '../../hooks/reduxHooks';
import axios from '../../utils/axios';

export default function PopupMenu({
  onClickAway = () => {},
}: {
  onClickAway?: () => void;
}) {
  const { isDarkTheme, toggleDarkTheme } = useContext(DarkThemeContext);

  const dispatch = useAppDispatch();

  const { user } = useAppSelector((state) => state.user);

	const navigate = useNavigate()

  return (
    <ClickAwayListener onClickAway={onClickAway}>
      <div
        className={
          isDarkTheme ? styles['popup-menu-dark'] : styles['popup-menu']
        }
      >
        <Link
          className={
            isDarkTheme
              ? styles['popup-menu__profile-dark']
              : styles['popup-menu__profile']
          }
          to={`/profile/${user?.username}`}
					onClick={onClickAway}
        >
          <svg
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M12 24C5.38286 24 0 18.6171 0 12C0 5.38286 5.38286 0 12 0C18.6171 0 24 5.38286 24 12C24 18.6171 18.6171 24 12 24ZM12 1.05023C5.96256 1.05023 1.05023 5.96256 1.05023 12C1.05023 18.0374 5.96256 22.9498 12 22.9498C18.0374 22.9498 22.9498 18.0374 22.9498 12C22.9498 5.96256 18.0374 1.05023 12 1.05023Z"
              fill={isDarkTheme ? '#9b9b9b' : '#757575'}
            />
            <path
              d="M11.9999 14.5421C9.74835 14.5421 7.9165 12.7103 7.9165 10.4585C7.9165 8.20692 9.74831 6.37507 11.9999 6.37507C14.2516 6.37507 16.0834 8.20687 16.0834 10.4585C16.0834 12.7103 14.2516 14.5421 11.9999 14.5421ZM11.9999 7.42557C10.3276 7.42557 8.96682 8.78617 8.96682 10.4587C8.96682 12.131 10.3276 13.4918 11.9999 13.4918C13.6723 13.4918 15.033 12.1308 15.033 10.4585C15.033 8.78617 13.6723 7.42557 11.9999 7.42557Z"
              fill={isDarkTheme ? '#9b9b9b' : '#757575'}
            />
            <path
              d="M5.66383 22.0877C5.64638 22.0877 5.62894 22.0866 5.61149 22.0849C5.32266 22.0565 5.11173 21.7992 5.14028 21.5106C5.49026 17.9696 8.43916 15.2994 11.9997 15.2994C13.8357 15.2994 15.57 16.0144 16.8822 17.3126C18.0127 18.4572 18.713 19.9475 18.8589 21.5134C18.8859 21.8022 18.6737 22.0582 18.3847 22.085C18.0899 22.1141 17.8398 21.8995 17.813 21.6108C17.6895 20.2858 17.0951 19.023 16.1391 18.055C15.0287 16.9572 13.5571 16.3497 11.9995 16.3497C8.98164 16.3497 6.48216 18.6127 6.18532 21.6135C6.15871 21.8848 5.93016 22.0875 5.66337 22.0875L5.66383 22.0877Z"
              fill={isDarkTheme ? '#9b9b9b' : '#757575'}
            />
          </svg>
          Profile
        </Link>
        <button
          className={
            isDarkTheme
              ? styles['popup-menu__theme-switch-dark']
              : styles['popup-menu__theme-switch']
          }
          type="button"
          onClick={toggleDarkTheme}
        >
          {isDarkTheme ? (
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M12 5.858C10.3709 5.858 8.80872 6.505 7.65701 7.65701C6.50503 8.80872 5.858 10.371 5.858 12C5.858 13.629 6.505 15.1913 7.65701 16.343C8.80872 17.495 10.371 18.142 12 18.142C13.629 18.142 15.1913 17.495 16.343 16.343C17.495 15.1913 18.142 13.629 18.142 12C18.1409 10.3712 17.4936 8.80983 16.3419 7.65806C15.1902 6.50628 13.6288 5.85904 12 5.858ZM12 16.5855C10.7839 16.5855 9.61784 16.1025 8.75791 15.2424C7.89778 14.3825 7.41479 13.2164 7.41479 12.0003C7.41479 10.7841 7.89779 9.61811 8.75791 8.75819C9.61777 7.89806 10.7839 7.41506 12 7.41506C13.2161 7.41506 14.3822 7.89807 15.2421 8.75819C16.1022 9.61804 16.5852 10.7841 16.5852 12.0003C16.583 13.2158 16.0995 14.3808 15.2399 15.2401C14.3806 16.0997 13.2156 16.5833 12.0001 16.5854L12 16.5855ZM11.2216 3.80272V0.778393C11.2216 0.348598 11.5699 0 12 0C12.4301 0 12.7784 0.348612 12.7784 0.778393V3.80272C12.7784 4.23279 12.4301 4.58139 12 4.58139C11.5699 4.58139 11.2216 4.23278 11.2216 3.80272ZM5.70217 2.65859C5.48741 2.28554 5.61529 1.80874 5.98834 1.59404C6.36139 1.379 6.8379 1.50716 7.05288 1.87994L8.56303 4.50322V4.50349C8.67706 4.68241 8.71263 4.90016 8.6624 5.10623C8.6119 5.3123 8.47941 5.48879 8.29587 5.59494C8.11206 5.7011 7.89296 5.72771 7.68933 5.66879C7.48542 5.6096 7.31465 5.46978 7.21636 5.2819L5.70217 2.65859ZM1.59974 6.0098C1.81478 5.64055 2.28746 5.51376 2.65859 5.72554L5.27811 7.23568V7.23596C5.65089 7.45071 5.77904 7.92748 5.56401 8.3005C5.34925 8.67328 4.87249 8.80143 4.49974 8.5864L1.88001 7.0725C1.50995 6.85584 1.38478 6.3807 1.59982 6.00983L1.59974 6.0098ZM3.80272 12.7785H0.778392C0.348598 12.7785 0 12.4301 0 12.0001C0 11.57 0.348611 11.2217 0.778392 11.2217H3.80272C4.23279 11.2217 4.58139 11.57 4.58139 12.0001C4.58139 12.4301 4.23278 12.7785 3.80272 12.7785ZM5.29737 16.772L2.65859 18.2979C2.53994 18.365 2.40555 18.4 2.26925 18.3989C1.91737 18.3984 1.60976 18.1619 1.51879 17.8222C1.42757 17.4823 1.57581 17.1236 1.8799 16.9471L4.50318 15.437H4.50345C4.87297 15.2434 5.32938 15.3759 5.53818 15.737C5.74697 16.0984 5.63402 16.56 5.28187 16.7837L5.29737 16.772ZM8.58637 19.4966L7.07247 22.1202C6.93346 22.3607 6.67689 22.5089 6.39886 22.5092C6.2623 22.5089 6.1279 22.4728 6.00979 22.4042C5.6381 22.1888 5.51104 21.7134 5.72553 21.3415L7.23568 18.722H7.23595C7.45071 18.3492 7.92747 18.221 8.3005 18.4361C8.67327 18.6508 8.80142 19.1276 8.58639 19.5003L8.58637 19.4966ZM12.7784 20.1973V23.2217C12.7784 23.6515 12.4301 24.0001 12 24.0001C11.5699 24.0001 11.2216 23.6515 11.2216 23.2217V20.1973C11.2216 19.7673 11.5699 19.4187 12 19.4187C12.4301 19.4187 12.7784 19.7673 12.7784 20.1973ZM18.2978 21.3415C18.5123 21.7134 18.3853 22.1888 18.0136 22.4042C17.8346 22.5084 17.6215 22.5372 17.4214 22.4837C17.221 22.4305 17.0505 22.2996 16.9471 22.1202L15.4369 19.4969V19.4966C15.2434 19.1271 15.3759 18.6707 15.737 18.4619C16.0983 18.2531 16.5599 18.366 16.7836 18.7182L18.2978 21.3415ZM22.4003 18.0058C22.1849 18.3775 21.7095 18.5045 21.3376 18.29L18.7143 16.7799C18.3413 16.5648 18.2131 16.0881 18.4281 15.7153C18.6432 15.3423 19.1197 15.2141 19.4927 15.4292L22.1201 16.9276C22.4901 17.1443 22.6153 17.6194 22.4003 17.9903V18.0058ZM24 12.0001C24 12.2064 23.918 12.4046 23.7719 12.5504C23.6259 12.6965 23.4279 12.7785 23.2216 12.7785H20.1973C19.7672 12.7785 19.4186 12.4301 19.4186 12.0001C19.4186 11.57 19.7672 11.2217 20.1973 11.2217H23.2216C23.4279 11.2217 23.6259 11.3037 23.7719 11.4498C23.918 11.5956 24 11.7937 24 12.0001ZM18.7026 7.21642L21.3414 5.70224C21.7145 5.48748 22.1913 5.61536 22.406 5.98841C22.621 6.36146 22.4928 6.83797 22.1201 7.05295L19.4968 8.5631H19.4965C19.3789 8.63369 19.2443 8.67008 19.1074 8.66817C18.7556 8.66763 18.4479 8.43115 18.3567 8.09149C18.2658 7.75157 18.4137 7.39289 18.7181 7.21642H18.7026ZM15.4136 4.49187L16.9275 1.87999C17.0261 1.69211 17.1969 1.55228 17.4005 1.49336C17.6044 1.43417 17.8232 1.46078 18.007 1.56694C18.1906 1.6731 18.3231 1.84958 18.3736 2.05565C18.4241 2.26172 18.3882 2.47947 18.2745 2.65866L16.7643 5.27819H16.764C16.5493 5.65097 16.0725 5.77912 15.6995 5.56409C15.3267 5.34933 15.1986 4.87256 15.4136 4.49982L15.4136 4.49187Z"
                fill="#9b9b9b"
              />
            </svg>
          ) : (
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M23.9852 13.6993C23.5106 16.6371 22.0175 19.2252 19.8891 21.0711C17.7825 22.8975 15.0544 24 12.0743 24C8.74019 24 5.72118 22.6218 3.53625 20.3929C1.3511 18.164 0 15.0843 0 11.6842C0 9.01995 0.830937 6.55183 2.24305 4.53502C3.69343 2.46433 5.7566 0.870243 8.16282 0.03033C8.45666 -0.0709119 8.77492 0.0895762 8.87485 0.3886C8.9343 0.567735 8.90201 0.75576 8.80361 0.899694C8.34065 1.64918 7.97779 2.46679 7.73161 3.33458C7.4921 4.17762 7.36432 5.07334 7.36432 6.00649C7.36432 8.65729 8.41716 11.0563 10.1202 12.7934C11.8226 14.5299 14.1752 15.6045 16.7739 15.6045C17.9611 15.6045 19.0963 15.3805 20.1412 14.972C21.2256 14.5478 22.2139 13.9242 23.0624 13.1463C23.2931 12.9342 23.6481 12.9537 23.856 13.189C23.9831 13.3329 24.0249 13.5248 23.986 13.7008L23.9852 13.6993ZM19.164 20.1972C20.7261 18.8422 21.9112 17.048 22.5342 15.0019C21.9125 15.4172 21.2447 15.7678 20.5409 16.043C19.3705 16.5009 18.1002 16.7511 16.7732 16.7511C13.8644 16.7511 11.2313 15.5482 9.32447 13.6042C7.41865 11.6593 6.23938 8.97329 6.23938 6.0063C6.23938 4.97349 6.38493 3.97009 6.65519 3.01673C6.78075 2.57377 6.93365 2.14216 7.1115 1.7255C5.53469 2.54467 4.17847 3.74146 3.1579 5.20002C1.8787 7.0271 1.12565 9.2658 1.12565 11.6849C1.12565 14.7689 2.35119 17.5614 4.33272 19.5827C6.31424 21.6039 9.05113 22.854 12.0753 22.854C14.7798 22.854 17.2551 21.8549 19.1649 20.198L19.164 20.1972Z"
                fill="#757575"
              />
            </svg>
          )}
          {isDarkTheme ? 'Light theme' : 'Dark theme'}
        </button>
        <button
          className={
            isDarkTheme
              ? styles['popup-menu__signout-dark']
              : styles['popup-menu__signout']
          }
          type="button"
          onClick={async () => {
						dispatch(signOut());
            toast.info('You signed out');
            dispatch(deleteMessage());
						navigate('/')
            await axios.get('/user/signout');
          }}
        >
          <svg
            width="24"
            height="20"
            viewBox="0 0 24 20"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M6.93091 9.57764H20.1658V10.9861H6.93091V9.57764Z"
              fill={isDarkTheme ? '#9B9B9B' : '#757575'}
            />
            <path
              d="M20.8111 6.72754L19.7869 7.64867L22.0895 10.419L19.4258 12.8136L20.3112 13.879L24 10.5632L20.8111 6.72754Z"
              fill={isDarkTheme ? '#9B9B9B' : '#757575'}
            />
            <path
              d="M17.1564 15.9157C17.1564 17.3912 16.0019 18.4186 14.5831 18.4186L3.92775 18.4184C2.50897 18.4184 1.35453 17.3912 1.35453 15.9155V4.08447C1.35453 2.60901 2.50897 1.40845 3.92775 1.40845H14.5831C16.0019 1.40845 17.1564 2.60901 17.1564 4.08447L17.1637 7.53922H18.5105V4.08467C18.5105 1.8325 16.7484 0.000196492 14.583 0.000196492L3.92758 0C1.76192 0 0 1.8325 0 4.08448V15.9155C0 18.1677 1.76211 20 3.92758 20H14.583C16.7486 20 18.5105 18.1675 18.5105 15.9305L18.5179 12.7644L17.221 12.7345L17.1564 15.9157Z"
              fill={isDarkTheme ? '#9B9B9B' : '#757575'}
            />
          </svg>
          Sign out
        </button>
      </div>
    </ClickAwayListener>
  );
}
